

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Practical Finite Elements &#8212; Geodynamics with Underworld</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Methods for Solving Numerical Problems" href="NumericalMethods5.html" />
    <link rel="prev" title="Introduction to the Finite Element Method" href="NumericalMethods3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/MundusSubterraneus.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Geodynamics with Underworld</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../FrontPage.html">
   Geodynamics with Underworld
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction and Background
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part0-Introduction/Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematical Fluid Dynamics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/ContinuumMechanics.html">
   Conservation Laws
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/NavierStokes.html">
   Navier-Stokes Equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/MantleDynamics.html">
   Non-dimensional equations &amp; dimensionless numbers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/ThermalConvection.html">
   Thermal Convection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/LithosphericDynamics.html">
   Dynamics of the Lithosphere
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Numerical Modeling
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods1.html">
   Numerical Modeling in Solid Earth Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods2.html">
   Survey of numerical methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods3.html">
   Introduction to the Finite Element Method
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Practical Finite Elements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods5.html">
   Methods for Solving Numerical Problems
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python for Geoscientists
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/0-StartHere.html">
   Python for Earth Scientists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/NumpyAndScipy/0-NumpyAndScipy.html">
   Numpy and Scipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/Plotting/1-IntroductionToMatplotlib.html">
   Introduction to matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/Mapping/00-Maps_with_Cartopy.html">
   Maps with the Cartopy Package
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/SphericalMeshing/0-Stripy.html">
   Triangulations
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Part3-NumericalMethods/NumericalMethods4.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Underworld-Geodynamics-Education/GeodynamicsJupyterBook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#weak-forms-of-real-equations">
   Weak Forms of Real Equations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-heat-conduction">
     1D Heat Conduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     2D Heat Conduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-3d-fluid-flow">
     2D/3D Fluid Flow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#galerkin-approximate-weak-form">
   Galerkin Approximate Weak Form
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generalization">
   Generalization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discretization-shape-functions">
   Discretization &amp; Shape Functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#naming-of-things-and-what-they-are-like">
     Naming of Things and What They are Like}
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#element-matrices">
     Element Matrices
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-integration">
   Numerical Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#standard-form-for-everything">
   Standard Form for Everything
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constraints">
   Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stresses">
   Stresses
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="practical-finite-elements">
<h1>Practical Finite Elements<a class="headerlink" href="#practical-finite-elements" title="Permalink to this headline">¶</a></h1>
<div class="math notranslate nohighlight">
\[
\newcommand{\dGamma}{\mathbf{d}\boldsymbol{\Gamma}}
\newcommand{\erfc}{\mbox{\rm erfc}}
\newcommand{\curly}{\sf }
\newcommand{\Red     }[1]{\textcolor[rgb]{0.7,0.0,0.0}{ #1}} 
\newcommand{\Green   }[1]{\textcolor[rgb]{0.0,0.7,0.0}{ #1}} 
\newcommand{\Blue    }[1]{\textcolor[rgb]{0.0,0.0,0.7}{ #1}} 
\newcommand{\Emerald }[1]{\textcolor[rgb]{0.0,0.7,0.3}{ #1}} 
\]</div>
<div class="section" id="weak-forms-of-real-equations">
<h2>Weak Forms of Real Equations<a class="headerlink" href="#weak-forms-of-real-equations" title="Permalink to this headline">¶</a></h2>
<p>As we discovered earlier, the Galerkin form of weighted residual approximate method can be made equivalent to a full variational problem if integration by parts is employed in the correct manner. This then allows the development of fully automatic variational methods for arbitrary strong forms of the governing equations. From here on we follow the notation of Hughes (The Finite Element Method) which is reasonably clear.</p>
<div class="section" id="d-heat-conduction">
<h3>1D Heat Conduction<a class="headerlink" href="#d-heat-conduction" title="Permalink to this headline">¶</a></h3>
<p>The differential or strong form of the equation we have encountered a number of times is</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    \begin{split}
        \frac{d^2 u}{d x^2} - {\curly f} &amp;= 0 \;\;\; \text{on} \;\;\; \Omega \\
        u(1) &amp; = {\curly g} \\
        -\frac{d u}{d x} (0) &amp;= {\curly h}
    \end{split}
\end{split}\]</div>
<p>where the boundary conditions are supplied at either end of a domain of unit length.</p>
<p>To find the weak form of the equation we need to have a set of functions <span class="math notranslate nohighlight">\(\curly S\)</span> to use for the trial functions which satisfy the boundary condition <span class="math notranslate nohighlight">\(\curly g\)</span> on <span class="math notranslate nohighlight">\(u\)</span> at <span class="math notranslate nohighlight">\(x=1\)</span>. We also need a set of weighting functions which are zero at <span class="math notranslate nohighlight">\(x=1\)</span> which we call <span class="math notranslate nohighlight">\(\curly V\)</span>. The weighting functions play the role of the variations.</p>
<p>The statement of the weak form of the problem (as distinct from its solution which will wait till later) is then to find <span class="math notranslate nohighlight">\(u \in {\curly S}\)</span> such that for all <span class="math notranslate nohighlight">\(w \in {\curly V}\)</span></p>
<div class="math notranslate nohighlight">
\[ 
    {\int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx + w(0) h = 0}
\]</div>
<p>This looks a lot like the variational solutions we found before. How do we get to it ?
The procedure is relatively general (except that in higher dimensions it becomes more
time consuming). First assume we have found the solution to the strong form, <span class="math notranslate nohighlight">\(u\)</span>. This must
satisfy</p>
<div class="math notranslate nohighlight">
\[ 
    0 = \int_0^1 w( \frac{d^2 u}{d x^2} - {\curly f} )dx
\]</div>
<p>by the definition of the problem, as long as <span class="math notranslate nohighlight">\(w\)</span> is well behaved, which
is ensured by a sensible choice of weighting functions. This starts to look
a lot like the Galerkin approach although we are not yet seeking an approximate
solution. Now integrate by parts to give</p>
<div class="math notranslate nohighlight">
\[ 
    0 = \int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx - \int_0^1 w f dx - \left[ w \frac{d u}{d x} \right]_0^1
\]</div>
<p>the boundary conditions on <span class="math notranslate nohighlight">\(du / dx\)</span> are substituted to give the weak form as above.
We write the equation in terms of the symmetric operators:</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    \begin{split}
    a(w,u) &amp; \equiv     \int_0^1 \frac{d w }{d x} \frac{d u}{d x} dx \\
    (w,{\curly f})  &amp; \equiv  \int_0^1 w f dx
    \end{split}
 \end{split}\]</div>
<p>to obtain an abstract form which can be used for all the finite element
formulations we derive here</p>
<div class="math notranslate nohighlight">
\[ 
    a(w,u) = (w,{\curly f})  + w(0){\curly h}
    \label{eq:FEabst}
\]</div>
<p>Note, that the partial differentiation step produces a symmetric operator from the
non symmetric initial form. This approach also works in 2D as follows.</p>
</div>
<div class="section" id="id1">
<h3>2D Heat Conduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Define a heat flux (vector), <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> related to temperature, <span class="math notranslate nohighlight">\(u\)</span> as    follows</p>
<div class="math notranslate nohighlight">
\[    q_i = -K_{ij} \frac{\partial u}{\partial x_j}
 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{K}\)</span> is the symmetric conductivity tensor. (This is the generalized version of Fourier’s law). A volumetric heating rate of <span class="math notranslate nohighlight">\(\curly f\)</span> gives the following strong form</p>
<div class="math notranslate nohighlight">
\[\begin{split}    \begin{split}
        \nabla q - {\curly f} &amp;= 0  \;\;\; \text{on} \;\;\; \Omega \\
        u &amp; = {\curly g} \;\;\; \text{on} \;\;\;  \Gamma_{\curly g} \\
        -q_i n_i &amp;= {\curly h} \;\;\; \text{on} \;\;\; \Gamma_{\curly h}
    \end{split}
 
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Gamma_ {\curly g}\)</span> and <span class="math notranslate nohighlight">\(\Gamma_{\curly h}\)</span> are the regions of the boundary with fixed temperatures and fixed fluxes respectively, <span class="math notranslate nohighlight">\(\mathbf{n}\)</span> is the unit normal over <span class="math notranslate nohighlight">\(\Gamma_{\curly h}\)</span>.</p>
<p>The corresponding weak form (found in the usual way) is</p>
<div class="math notranslate nohighlight">
\[
    -\int_\Omega  \frac{\partial w}{\partial x_j} q_i d\Omega = \int_\Omega w {\curly f} d\Omega + \int_{\Gamma_{\curly h}} w{\curly h} d\Gamma
\]</div>
<p>The symmetry of the operator is not obvious here until we substitute the constitutive law to obtain</p>
<div class="math notranslate nohighlight">
\[
    \int_\Omega  \frac{\partial w}{\partial x_j} q_i d\Omega =
     \int_\Omega  \frac{\partial w}{\partial x_j} K_{ij} \frac{\partial u}{\partial x_j} d\Omega = 
     \int_\Omega  (\nabla w)^T \mathbf{K} (\nabla u) d\Omega
\]</div>
</div>
<div class="section" id="d-3d-fluid-flow">
<h3>2D/3D Fluid Flow<a class="headerlink" href="#d-3d-fluid-flow" title="Permalink to this headline">¶</a></h3>
<p>Now we finally come around to the problem we really need to solve. The strong form of the Stokes’ flow problem is identical to that of linear elasticity (which is what all the finite element textbooks deal with). The general constitutive law is</p>
<div class="math notranslate nohighlight">
\[ 
    \sigma_{ij} = c_{ijkl} \epsilon_{kl}
\]</div>
<p>which reduces to <span class="math notranslate nohighlight">\(\sigma_{ij} = \eta \epsilon_{ij}\)</span> for homogeneous fluid.
<span class="math notranslate nohighlight">\(\epsilon_{ij}\)</span> is defined by</p>
<div class="math notranslate nohighlight">
\[ 
    \epsilon_{ij} = \frac{\partial u_i}{\partial x_j} +  \frac{\partial u_j}{\partial x_i}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> now represents the fluid velocity.</p>
<p>The strong form of the equation is</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{split}
        \frac{\partial \sigma_{ij}}{\partial x_j} + {\curly f}_i = 0  \;\;\; \text{on} \;\;\;  \Omega \\
            u_i &amp; = {\curly g}_i \;\;\; \text{on} \;\;\;  \Gamma_{{\curly g}_i} \\
            \sigma_{ij} n_i &amp;= {\curly h}_i \;\;\; \text{on} \;\;\; \Gamma_{{\curly h}_i}
\end{split}
\end{split}\]</div>
<p>with a corresponding weak form</p>
<div class="math notranslate nohighlight">
\[ 
    \int_\Omega \left(  \frac{\partial w_i}{\partial x_j} +  \frac{\partial w_j}{\partial x_i}  \right) \sigma_{ij} d \Omega =
        \int_\Omega w_i {\curly f}_i d\Omega + 
        \sum_{d=1}^{n_{\rm dim}} \left[ \int_{\Gamma_{{\curly h}_i}} w_i h_i d\Gamma \right]
\]</div>
<p>Which is symmetric in the trial functions and the unknown velocities since</p>
<div class="math notranslate nohighlight">
\[ 
    \int_\Omega \left(  \frac{\partial w_i}{\partial x_j} +  \frac{\partial w_j}{\partial x_i}  \right) \sigma_{ij} d \Omega =
    \int_\Omega \left(  \frac{\partial w_i}{\partial x_j} +  \frac{\partial w_j}{\partial x_i}  \right) c_{ijkl}
        \left(  \frac{\partial u_i}{\partial x_j} +  \frac{\partial u_j}{\partial x_i} \right) d \Omega
\]</div>
</div>
</div>
<div class="section" id="galerkin-approximate-weak-form">
<h2>Galerkin Approximate Weak Form<a class="headerlink" href="#galerkin-approximate-weak-form" title="Permalink to this headline">¶</a></h2>
<p>We have one last task before we can develop a real numerical method. How do we get away from the highly abstract notion of trial functions, weighting functions, and weak forms to produce a compact system of equations which can be written out in a nice tidy matrix form. The answer lies in the Galerkin approximate solution method. Let us go back to the 1D problem for a moment. We have to express our solution in terms of a sum over basis functions as before</p>
<div class="math notranslate nohighlight">
\[ 
        w^h = \sum_{A=1}^{n} c_A  N_A
\]</div>
<p>where the <span class="math notranslate nohighlight">\(h\)</span> superscript indicates that we have moved from an infinite choice of functions to a finite one based on the discrete functions <span class="math notranslate nohighlight">\(N_A\)</span> which we will define in a minute, although for now we need to ensure that they are zero where the boundary conditions apply in the same way as <span class="math notranslate nohighlight">\(\curly V\)</span>. We define a corresponding expansion for <span class="math notranslate nohighlight">\(u\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    \begin{split}
        u^h &amp;= \sum_{A=1}^{n} d_A  N_A + {\curly g}N_{n+1} \\
        {\curly g}^h &amp;= {\curly g} N_{n+1}
    \end{split}
\end{split}\]</div>
<p>which includes an extra basis function to allow the boundary condition (<span class="math notranslate nohighlight">\(u(1)={\curly g}\)</span>) to be satisfied.</p>
<p>Substituting into (\ref{eq:FEabst}) gives</p>
<div class="math notranslate nohighlight">
\[ 
    a\left( \sum_{A=1}^n c_A N_A , \sum_{B=1}^n d_B N_B \right) = 
    \left( \sum_{A=1}^n c_A N_A , {\curly f} \right) + \left[ \sum_{A=1}^n c_A N_A(0) \right] {\curly h}
    -a\left( \sum_{A=1}^n c_A N_A , {\curly g} N_{n+1} \right)
\]</div>
<p>Our operators are symmetric and wholly linear, so the order of summation and application
of the operator can be interchanged freely to give:
$<span class="math notranslate nohighlight">\( 
    0 =     \sum_{A=1}^n c_A G_A
\)</span>$</p>
<p>where</p>
<div class="math notranslate nohighlight">
\[ 
    G_A = \sum_{B=1}^n a(N_A,N_B)d_B - (N_A,{\curly f}) - N_A(0){\curly h} + a(N_A,A_{n+1}){\curly g}
\]</div>
<p>As we have done many times before, we appeal to the argument that the particular choice of variation must be totally arbitrary: this equation must hold no matter what <span class="math notranslate nohighlight">\(w^h \in {\curly S}^h\)</span> we choose, and hence no matter what the combination of <span class="math notranslate nohighlight">\(c_A\)</span> may be. This then means that <span class="math notranslate nohighlight">\(G_A\)</span> must be identically zero independent of <span class="math notranslate nohighlight">\(c_A\)</span>, i.e.</p>
<div class="math notranslate nohighlight">
\[ 
     \sum_{B=1}^n a(N_A,N_B)d_B =  (N_A,{\curly f} ) 
     - N_A(0){\curly h} +
      a(N_A,A_{n+1}) {\curly g}
     \label{eq:gal2}
 \]</div>
<p>As in the standard variational method, we have eliminated all references to the actual variation and left unknowns which only related to the physical variables (i.e. the coefficients of the expansion for <span class="math notranslate nohighlight">\(u\)</span>).</p>
<p>If we simply write
$<span class="math notranslate nohighlight">\( 
    \begin{split}
        K_{AB} &amp;= a(N_A,N_B)\\
        F_A &amp;= (N_A,{\curly f}) + N_A(0)h - a(N_A,N_n+1){\curly g}
    \end{split}
    \label{eq:FEstdform}
\)</span>$</p>
<p>then we have a matrix formulation immediately since (\ref{eq:gal2}) now becomes</p>
<div class="math notranslate nohighlight">
\[ 
    \sum_{B=1}^n  K_{AB} d_B = F_A  \;\;\;\;\;\; A=1,2,3,\ldots
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[ 
    \mathbf{K d} = \mathbf{F}
\]</div>
<p>The matrix <span class="math notranslate nohighlight">\(\mathbf{K}\)</span> is known as the stiffness matrix — the association with the matrix of stiffnesses from our discrete set of springs being obvious.</p>
</div>
<div class="section" id="generalization">
<h2>Generalization<a class="headerlink" href="#generalization" title="Permalink to this headline">¶</a></h2>
<p>The same argument can be applied to higher dimensions, and to problems with different constitutive laws, and vector unknowns, however, the identification of the components of the stiffness matrix with the operator <span class="math notranslate nohighlight">\(a(\cdot,\cdot)\)</span> acting on every possible combination of the galerkin basis functions still holds. When the unknowns are vectors, the basis functions are used in each respective direction which complicates the notation even more than before. Essentially, though it means that the entries to <span class="math notranslate nohighlight">\(\mathbf{K}\)</span> from each <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are actually matrices which are <span class="math notranslate nohighlight">\(n_{\rm dim} \times n_{\rm dim}\)</span>.</p>
<p>For example, in the constant viscosity Stokes’ flow problem, we now have</p>
<div class="math notranslate nohighlight">
\[ 
    \left. K_{AB}\right|_{ij}  =    \int_\Omega
                    \left(  \frac{\partial N_A}{\partial x_j} +  \frac{\partial N_A}{\partial x_i}  \right) \eta
                    \left(  \frac{\partial N_B}{\partial x_j} +  \frac{\partial N_B}{\partial x_i} \right) d \Omega
    \label{eq:festokes}         
\]</div>
</div>
<div class="section" id="discretization-shape-functions">
<h2>Discretization &amp; Shape Functions<a class="headerlink" href="#discretization-shape-functions" title="Permalink to this headline">¶</a></h2>
<p>Although we have now nominally made our problem finite by expressing everything in terms of Galerkin basis functions, we have yet to decide what those functions ought to be. Whatever our choice, it should make the problem easy to compute numerically.</p>
<p><img alt="Splitting an arbitrary domain into patches is trivial in an integral formulation. Additionally, the irregular shape of the individual subdomains is easy to handle with standard changes of variables (Jacobians)" src="../_images/domain.png" /></p>
<p>The choice of basis functions is very broad but we narrow it down by tying it very closely to the way we choose to split up the domain of our problem. With an integral method, the domain decomposition is simple since</p>
<div class="math notranslate nohighlight">
\[  
     \int_\Omega d\Omega = \int_{\Omega_1} d {\Omega_1} + 
            \int_{\Omega_2} d {\Omega_2} + \int_{\Omega_3} d {\Omega_3} + \ldots
            \label{eq:decomp}
\]</div>
<p>which means that the decomposition <a class="reference external" href="#domain-decomp">shown above</a> is as accurate as the representation of the boundary allows.</p>
<p>The functions which interpolate the node points at the corners of  subdomains are a suitable set for use as an approximate basis as we require for the Galerkin formulation. This is easy to see if we consider a one dimensional problem.</p>
<p><img alt="Representing a piecewise linear function as a sum of pointy functions localized at the nodes." src="../_images/linedisc.png" /></p>
<p>In the one dimensional case, the choice of subdomains is limited to breaking up the line into a number of segments, though not necessarily of equal length. If the approximation to the continuum field, <span class="math notranslate nohighlight">\(u\)</span> is made by linear interpolation to give <span class="math notranslate nohighlight">\(u^h\)</span>, then <span class="math notranslate nohighlight">\(u^h\)</span> can also be expressed as a sum on the <a class="reference external" href="#discretisation-1d">local triangular functions <span class="math notranslate nohighlight">\(N_A\)</span></a></p>
<div class="math notranslate nohighlight">
\[ 
        u^h = \sum_{A} u(x_A) N_A(x)
\]</div>
<p>This is an exact representation of the interpolation provided the <span class="math notranslate nohighlight">\(N_A\)</span> takes the value one at node <span class="math notranslate nohighlight">\(A\)</span> and zero at all other nodes, and varies in a linear manner in between.</p>
<p>Note that the functions all take the same form apart from scaling. Also, because the basis functions are localized around a node and its neighbours, the direct interaction between a node and its immediate neighbours is non-zero but the interaction with more distant nodes is zero. This makes the stiffness matrix banded — more importantly it is sparse and therefore the potentially enormous number of interactions (the square of the number of unknowns) is contained. This procedure can be extended to higher dimensions and to higher order interpolations as shown in [the Figure below][#shape-functions]</p>
<div class="section" id="naming-of-things-and-what-they-are-like">
<h3>Naming of Things and What They are Like}<a class="headerlink" href="#naming-of-things-and-what-they-are-like" title="Permalink to this headline">¶</a></h3>
<p>The interpolation functions are known as shape functions. The subdomains are known as elements. The elements correspond to the individual springs of our discrete example. The shape functions are pure interpolation functions of the required order within the element and can be differentiated the appropriate number of times. This means that the order of interpolation must match the order of derivatives in the FE operator. Crossing the element boundaries, the shape functions have discontinuous derivatives (as do the piecewise interpolations). Continuous derivative functions are possible (e.g. splines) but add significant complexity. Shape functions in 2D and 3D can be formed from the product of 1D shape functions in each direction.</p>
<p><img alt="Extension of simple shape function concept (a) to higher order functions and  (b) to higher dimensions" src="../_images/shapefn.png" /></p>
</div>
<div class="section" id="element-matrices">
<h3>Element Matrices<a class="headerlink" href="#element-matrices" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="#domain-decomp">domain decomposition illustrated above</a> produces a minature version of the matrix problem on the individual elements themselves.</p>
<div class="math notranslate nohighlight">
\[ 
            {k^e}_{ij} {d^e}_j = {f^e}_i
\]</div>
<p>The interpretation of the local problem is similar to that of the individual springs in the discrete example we derived earlier. By assembling the individual under-constrained element problems into the full problem we obtain a soluble system with the correct number of boundary conditions etc. The local equilibrium problem is identical with that of the global problem. That is, we use the same variational form and the same operators to build the local matrices. In general, finite element methods are designed around the local element frame of reference and large problems assembled from smaller ones. The book-keeping involved is to track which degrees of freedom in the local problem are associated with which others in the global problem. Clearly the interaction coefficient between one degree of freedom and another is derived from the local equilibrium relationships of a number of elements because the shape function for a given nodal point is spread across a number of elements.</p>
</div>
</div>
<div class="section" id="numerical-integration">
<h2>Numerical Integration<a class="headerlink" href="#numerical-integration" title="Permalink to this headline">¶</a></h2>
<p>The real power of finite elements comes from its ability to handle remarkably distorted geometries with ease. (Obviously this only applies in two or more dimensions). This is possible because simple mappings can be derived to convert a distorted element into a regular one (square, cubic, regular-tetrahedral). This takes the form of a change of variables which can be done {\em fully automatically} if we make minor restrictions on the choice of distortions we allow the elements to have. This restriction takes the form of ensuring that the mappings which transform the element shape can be described by the shape functions of the element. This means that only linear mappings can be applied to linear elements. If we wish to map a curved boundary exactly, then elements which have the appropriate order shape functions have to be used even if they are not needed for the representation of the differential operator. (e.g. quadratic elements for a circular boundary). This concept produces “isoparametric” elements.</p>
<p>The mapping shown in <span class="xref myst"></span> is achieved by a change of variables</p>
<div class="math notranslate nohighlight">
\[ 
     \int  \int_{\Omega^e} \phi dx dy = \int  \int_{\rm square} \phi {\curly j} d \xi d \eta
\]</div>
<p>where <span class="math notranslate nohighlight">\({\curly j}\)</span> is the jacobian of the transformation defined by</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
         {\curly j} = {\rm det} \frac{\partial \mathbf{x}}{\partial \boldsymbol{\xi}} = 
            {\rm det} \left[ \begin{array}{cc}  
                \frac{\partial x_1}{\partial \xi_1} &amp;  \frac{\partial x_1}{\partial \xi_2} \\
                \frac{\partial x_2}{\partial \xi_1} &amp;  \frac{\partial x_2}{\partial \xi_2}
                \end{array}    \right]
\end{split}\]</div>
<p>In the isoparametric concept, the components of the jacobian can be written as, for example,</p>
<div class="math notranslate nohighlight">
\[ 
\frac{\partial x_1}{\partial \xi_1} (\xi_1,\xi_2) = 
        \sum_{a=1}^{n_en} \frac{\partial N_a}{\partial \xi_1} {x_1}_a
    
\]</div>
<p>Now we have the integral of a number of things defined over a regular, square domain (or cube etc).  A number of ways to estimate these integrals is available. For example, in 1D the familiar trapezium rule can integrate linearly interpolated functions exactly. Given that our approximate method has already reduced the degree of polynomial within the element to something manageable, it is possible to find integration schemes which produce the {\em exact} integral for our approximation — in other words introducing no further error.</p>
<p>One possibility which is commonly used is Gaussian quadrature. This is a textbook method which can be made exact for any order of interpolation function desired. For linear interpolation in 2D, the following rule applies (assuming that we have transformed to a square element)</p>
<div class="math notranslate nohighlight">
\[ 
    \int_{-1}^{1} \!\! \int_{-1}^{1} \phi(\xi,\eta) d\xi d\eta  \ \ \ \cong \ \ \ 
    \sum_{l=1}^{n_{\rm int}} \phi( \tilde{ \xi_l}, \tilde{ \eta_l}) W_l
\]</div>
<p>In which <span class="math notranslate nohighlight">\(n_{\rm int}\)</span> is the number of points in the quadrature rule with co-ordinates <span class="math notranslate nohighlight">\((\tilde{ \xi_l}, \tilde{ \eta_l})\)</span>. Each point has a weight associated with it of <span class="math notranslate nohighlight">\(W_l\)</span>. For the four point rule:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p><span class="math notranslate nohighlight">\(l\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\tilde{\xi_l}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\tilde{\eta_l}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(W_l\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><span class="math notranslate nohighlight">\(-1/\sqrt{3}\)</span> &amp; <span class="math notranslate nohighlight">\(-1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><span class="math notranslate nohighlight">\(1/\sqrt{3}\)</span>  &amp; <span class="math notranslate nohighlight">\(-1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><span class="math notranslate nohighlight">\(-1/\sqrt{3}\)</span> &amp; <span class="math notranslate nohighlight">\(1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><span class="math notranslate nohighlight">\(1/\sqrt{3}\)</span>  &amp; <span class="math notranslate nohighlight">\(1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>The four-point rule in two dimensions is constructed by applying a two point, one dimensional rule to each of
the coordinates in turn. The integrals along the edges of the elements which are required to construct the boundary
force vectors are therefore should be calculated using the one dimensional, two point rule which, along an edge of the bi-unit master element is</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p><span class="math notranslate nohighlight">\(l\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\tilde{\xi_l}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(W_l\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><span class="math notranslate nohighlight">\(-1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><span class="math notranslate nohighlight">\(1/\sqrt{3}\)</span></p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>This naturally extends to three dimensional elements and their two dimensional boundaries.</p>
</div>
<div class="section" id="standard-form-for-everything">
<h2>Standard Form for Everything<a class="headerlink" href="#standard-form-for-everything" title="Permalink to this headline">¶</a></h2>
<p>Consider the heat 1D conduction problem one more time. We can rewrite the generalized Fourier law as</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
q_i = - \kappa_{ij} \frac{\partial u}{\partial x_j} =
    -\kappa_{ij} \left( \begin{array}{c} \frac{\partial}{\partial x_1} \\ \frac{\partial }{\partial x_2} \end{array} \right) u
\end{split}\]</div>
<p>If we express <span class="math notranslate nohighlight">\(u\)</span> in terms of the shape functions</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    u = \sum_A d_A N_A (x)  \rightarrow 
    q_i = -\kappa_{ij} \sum_A \left( \begin{array}{c} {\displaystyle \frac{\partial N_A}{\partial x_1}} \\ 
    { \displaystyle \frac{\partial N_A}{\partial x_2}} \end{array} \right) d_A
    q_i = - \sum_A \kappa_{ij} \left. B_A \right|_{j} d_A
\end{split}\]</div>
<p>This allows us to define a matrix <span class="math notranslate nohighlight">\(\mathbf{B_A}\)</span> which comes directly from the operators contained in the constitutive law.</p>
<p>Compare this with equation ( \ref{eq:FEstdform}) and, the more concrete example (\ref{eq:festokes}) and we see that the stiffness matrix coefficients can be obtained from</p>
<div class="math notranslate nohighlight">
\[ 
        K_{AB} = a(N_A,N_B) = \int_{\Omega} \mathbf{B}_A^T \mathbf{D} \mathbf{B}_B d\Omega
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{D}\)</span> is a matrix of material properties.  This form can be used for all problems and may greatly simplify both programming and the automation of the development of the equations since now we simply need to be able to express the constitutive law in terms of the unknowns, build a material property matrix and plug this into standard machinery.</p>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>We generally want to solve problems where there is a constraint on the unknowns. For example we wish to find a flow solution which also satisfies mass conservation (not unreasonable !). To see how this constraint may be applied we go back to the variational method and regard the equation <span class="math notranslate nohighlight">\({\bf Kd = f}\)</span> in the light of the functional</p>
<div class="math notranslate nohighlight">
\[ 
{\cal F} ({\bf d}) = \frac{{\bf d}^T{\bf Kd}}{2} - {\bf d}^T {\bf f}
\]</div>
<p>The vector which minimizes <span class="math notranslate nohighlight">\({\cal F} ({\bf d})\)</span> is the solution to <span class="math notranslate nohighlight">\({\bf Kd = f}\)</span> — this can be shown in the usual way. (Start with <span class="math notranslate nohighlight">\( {\cal F}({\bf d + \varepsilon c}) \)</span>, where <span class="math notranslate nohighlight">\(\varepsilon\)</span> is a free, real parameter and <span class="math notranslate nohighlight">\(\bf c\)</span> is arbitrary).</p>
<p>Consider a single constraint,</p>
<div class="math notranslate nohighlight">
\[ 
d_Q = {\curly g}
\]</div>
<p>which corresponds to specifying a value for one of the velocities in the problem having the index <span class="math notranslate nohighlight">\(Q\)</span> in the global numbering system. This constraint should be written as a function of <span class="math notranslate nohighlight">\(\bf d\)</span>  in the following way:</p>
<div class="math notranslate nohighlight">
\[ 
0 = {\cal G}({\bf d}) = {\bf 1}_Q^T{\bf d} - {\curly g}
\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray*}
{\bf 1}^T_Q = \left\langle 0 \ldots 0  \right. &amp; 1 &amp; \left. 0 \ldots 0 \right\rangle \\
 &amp; \uparrow &amp; \! \\  
 &amp; \text{  Q'th column} &amp; \nonumber
\end{eqnarray*}
\end{split}\]</div>
<p>Then finding the stationary value for the following function is equivalent to solving the constrained problem:</p>
<div class="math notranslate nohighlight">
\[ 
{\cal H}({\bf d},m) = {\cal F}({\bf d}) + m{\cal G}({\bf d})
\]</div>
<p>The condition that <span class="math notranslate nohighlight">\(\bf d\)</span> renders <span class="math notranslate nohighlight">\(\cal H\)</span> stationary is</p>
<div class="math notranslate nohighlight">
\[ 
0 = \left. \frac{d}{d\varepsilon} {\cal H}({\bf d}+\varepsilon{\bf c},m + \varepsilon l) \right|_{\varepsilon=0}
\;\;\; \forall {\bf c},l
\]</div>
<p>Substituting for <span class="math notranslate nohighlight">\(\cal H\)</span> gives:</p>
<div class="math notranslate nohighlight">
\[ 
0 = \left. \frac{d}{d\varepsilon} \left[ {\cal F}({\bf d}+\varepsilon{\bf c} )+
     (m+\varepsilon l){\cal G}({\bf d}+\varepsilon{\bf c} )\right] \right|_{\varepsilon=0}
\]</div>
<div class="math notranslate nohighlight">
\[ 
0= {\bf c}^T({\bf Kd -F) }+l {\cal G}({\bf d}) + m{\bf 1}_Q^T {\bf c}
\]</div>
<div class="math notranslate nohighlight">
\[ 
0= {\bf c}^T({\bf Kd} + m{\bf 1}_Q {\bf -f}) + l ({\bf 1}_Q^T {\bf d} -\mbox{\curly g})
\]</div>
<p>Since  <span class="math notranslate nohighlight">\(\bf c\)</span> and <span class="math notranslate nohighlight">\(l\)</span> are strictly  arbitrary,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
{\bf Kd }+m{\bf 1}_Q &amp;=&amp; {\bf f}\\ \nonumber
{\bf 1}_Q^T {\bf d} &amp; = &amp; {\curly g} \nonumber
\end{eqnarray}
\end{split}\]</div>
<p>Equivalently</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\left[ \begin{array}{cc} {\bf K} &amp; {\bf 1}_Q \\
            {\bf 1}_Q^T &amp; 0 \end{array} \right]
\left\{ \begin{array}{c} {\bf d} \\ \nonumber 
             m \end{array} \right\} =
\left\{\begin{array}{c} {\bf f} \\ \nonumber
             {\curly g} \end{array} \right\}
\end{split}\]</div>
<p>which establishes the pattern  expected  for adding constraints to the physical problem: augmentation of all the matrices with some forces (<span class="math notranslate nohighlight">\(\bf m\)</span>) as well as velocities (<span class="math notranslate nohighlight">\(\bf d\)</span>)  unknown. The coefficient matrix remains symmetric but is no longer positive definite.</p>
<p>An alternative way to enforce constraints and one which proves slightly simpler to implement, is to make an approximation to the Lagrange-multiplier as follows:</p>
<div class="math notranslate nohighlight">
\[ 
    m \cong k {\cal G}({\bf d})
\]</div>
<p>in which <span class="math notranslate nohighlight">\(k\)</span> is a large positive number. Form the following functional,</p>
<div class="math notranslate nohighlight">
\[ 
    {\cal J}({\bf d}) = {\cal F}({\bf d}) + \frac{k}{2} \left[{\cal G} ({\bf d})\right]^2 
\]</div>
<p>and consider the extremal values for <span class="math notranslate nohighlight">\(\cal J\)</span> which are defined by the following expression</p>
<div class="math notranslate nohighlight">
\[ 
    0 = \left. \frac{d}{d\varepsilon} \left( {\cal F}({\bf d}+\varepsilon {\bf c} )+
    \frac{k}{2} \left[ {\cal G} ({\bf d} + \varepsilon{\bf c}) \right]^2 \right) \right| _{\varepsilon = 0}
\]</div>
<div class="math notranslate nohighlight">
\[ 
    {\bf c}^T({\bf Kd - f}) + k {\bf G}({\bf d}) {\bf 1}_Q^T {\bf c}
\]</div>
<p>Substituting for <span class="math notranslate nohighlight">\(\cal G\)</span> gives</p>
<div class="math notranslate nohighlight">
\[ 
{\bf c}^T \left[ ({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} - ({\bf f} + k {\curly g} {\bf 1}_Q) \right] = 0
\]</div>
<p>Since <span class="math notranslate nohighlight">\(\bf c\)</span> is arbitrary, the following matrix equation is implied</p>
<div class="math notranslate nohighlight">
\[ 
({\bf K} + k{\bf 1}_Q{\bf 1}_Q^T){\bf d} = ({\bf f} + k {\curly g} {\bf 1}_Q)
\]</div>
<p>Now the dimension of the problem is not changed; the constraints are introduced by addition of another matrix equation. In the limit <span class="math notranslate nohighlight">\(k \rightarrow \infty\)</span>, <span class="math notranslate nohighlight">\(d_Q \rightarrow {\curly g}\)</span> and the constraint is applied exactly. The constraint of incompressibility is applied as the limiting case of slight compressibility. The large constant is known as the penalty parameter and gives its name to the method; its value is chosen according to the accuracy of the machine used to compute the solution to the problem. A suitable value is somewhere between <span class="math notranslate nohighlight">\(10^7\)</span> and <span class="math notranslate nohighlight">\(10^9\)</span>, any smaller and the fluid volume may not be conserved during hydrostatic loading.</p>
<p>The penalty method is computationally very simple, but can be ill conditioned. This becomes a serious issue when the matrix equation is not solved by direct methods. In the latter case, it is preferable to introduce additional variables. These take the form of pressures which, in the slightly compressible flow case can always be eliminated in favour of the constraint, and then recovered as</p>
<div class="math notranslate nohighlight">
\[ 
p = - \lambda \nabla . {\bf u}
\]</div>
<p>The augmented matrix equation then becomes</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\left( \begin{array}{cc} \mathbf{K} &amp; \mathbf{G} \\ \mathbf{G}^T &amp;  0 \end{array} \right) 
\left( \begin{array}{c} \mathbf{u} \\  \mathbf{p} \end{array} \right)= 
\left( \begin{array}{c} \mathbf{f} \\  \mathbf{0} \end{array} \right)
\end{split}\]</div>
<p>The components of the <span class="math notranslate nohighlight">\(\mathbf{G}\)</span> matrix are, at the element level found from</p>
<div class="math notranslate nohighlight">
\[ 
\left.  g^e_{a\tilde{a}}  \right|_{i} = -\int_{\Omega^e} {\rm div}(N_a) (\tilde{N})_{\tilde{a}} d\Omega
\]</div>
<p>The tilde indicates a pressure degree of freedom / shape function as constrasted with the standard velocity shape fucntions. The independent pressures require their own space of trial functions which can be of lower order than the velocity since the derivatives in the equations are also lower. In fact, it is necessary to use lower order functions for the pressure otherwise the problem is overconstrained and no non-trivial solution can be found. This is more of a difficulty when the penalty formulation is used since there are no additional variables and hence no associated trial functions. Instead a trick is used — the constraint terms are integrated using an order lower integration scheme than that required for exact solutions. The result turns out to be equivalent (usually) to the introduction of additional variables and lower order shape functions but the proof of this is another tricky matter.</p>
<!-- ## Incremental Formulations

In plasticity, for example, only incremental changes in the system are
meaningful since the stress is degenerate to multiple strains and depends 
on the loading history. In this situation one deals with an incremental 
formulation of the entire problem replacing the stiffness matrix with 
a tangent stiffness from a Newton-Raphson type procedure. This is not 
an issue with simple fluids but should be understood when brittle solids 
are considered. -->
</div>
<div class="section" id="stresses">
<h2>Stresses<a class="headerlink" href="#stresses" title="Permalink to this headline">¶</a></h2>
<p><strong>Note</strong> Derivatives of the shape functions are commonly not defined at the node points and consequently it is not possible to compute stresses etc at the nodal points. They are defined on the interiors of the elements and must be extrapolated to the nodes using some form of best fit procedure.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Part3-NumericalMethods"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="NumericalMethods3.html" title="previous page">Introduction to the Finite Element Method</a>
    <a class='right-next' id="next-link" href="NumericalMethods5.html" title="next page">Methods for Solving Numerical Problems</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Louis Moresi<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>