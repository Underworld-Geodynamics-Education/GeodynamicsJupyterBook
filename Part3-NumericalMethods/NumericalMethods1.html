

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Numerical Modeling in Solid Earth Dynamics &#8212; Geodynamics with Underworld</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Survey of numerical methods" href="NumericalMethods2.html" />
    <link rel="prev" title="Dynamics of the Lithosphere" href="../Part1-FluidDynamics/LithosphericDynamics.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/MundusSubterraneus.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Geodynamics with Underworld</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../FrontPage.html">
   Geodynamics with Underworld
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction and Background
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part0-Introduction/Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematical Fluid Dynamics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/ContinuumMechanics.html">
   Conservation Laws
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/NavierStokes.html">
   Navier-Stokes Equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/MantleDynamics.html">
   Non-dimensional equations &amp; dimensionless numbers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/ThermalConvection.html">
   Thermal Convection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part1-FluidDynamics/LithosphericDynamics.html">
   Dynamics of the Lithosphere
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Numerical Modeling
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Numerical Modeling in Solid Earth Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods2.html">
   Survey of numerical methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods3.html">
   Introduction to the Finite Element Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods4.html">
   Practical Finite Elements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NumericalMethods5.html">
   Methods for Solving Numerical Problems
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python for Geoscientists
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/0-StartHere.html">
   Python for Earth Scientists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/NumpyAndScipy/0-NumpyAndScipy.html">
   Numpy and Scipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/Plotting/1-IntroductionToMatplotlib.html">
   Introduction to matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/Mapping/00-Maps_with_Cartopy.html">
   Maps with the Cartopy Package
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Part2-Python/SphericalMeshing/0-Stripy.html">
   Triangulations
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Part3-NumericalMethods/NumericalMethods1.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Underworld-Geodynamics-Education/GeodynamicsJupyterBook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introductory-remarks">
   Introductory Remarks
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-modeling-primer">
   Numerical modeling primer
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-order-numerical-approximation">
     A first order numerical approximation}
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#higher-order-expansion">
     Higher order expansion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#our-first-code">
     Our First Code
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="numerical-modeling-in-solid-earth-dynamics">
<h1>Numerical Modeling in Solid Earth Dynamics<a class="headerlink" href="#numerical-modeling-in-solid-earth-dynamics" title="Permalink to this headline">¶</a></h1>
<div class="math notranslate nohighlight">
\[
\newcommand{\dGamma}{\mathbf{d}\boldsymbol{\Gamma}}
\newcommand{\erfc}{\mbox{\rm erfc}}
\newcommand{\curly}{\sf }
\newcommand{\Red     }[1]{\textcolor[rgb]{0.7,0.0,0.0}{ #1}} 
\newcommand{\Green   }[1]{\textcolor[rgb]{0.0,0.7,0.0}{ #1}} 
\newcommand{\Blue    }[1]{\textcolor[rgb]{0.0,0.0,0.7}{ #1}} 
\newcommand{\Emerald }[1]{\textcolor[rgb]{0.0,0.7,0.3}{ #1}} 
\]</div>
<div class="section" id="introductory-remarks">
<h2>Introductory Remarks<a class="headerlink" href="#introductory-remarks" title="Permalink to this headline">¶</a></h2>
<p>We have considered the application of mathematical reasoning to construct models of the behaviour of physical systems. Unfortunately, most of these models do not have analytic solutions or the solutions are so complicated that they don’t help us understand the problem. The alternative is to solve such problems numerically (approximately). Such solutions are also possible for far more elaborate systems than we would even consider trying to obtain exact solutions for.</p>
<p>On the other hand, numerical modeling only provides solutions to mathematical equations and only approximate solutions at that. Unless the modeler has an understanding of the methods and the models themselves, then the output of some computer code may be terribly misleading.</p>
<p>It is always necessary to design a numerical experiment as carefully as one would a physical experiment — although it won’t blow up and kill you. It is possible to change the laws of physics in the numerical model often inadvertantly, so a careful analysis of the problem first is not a bad idea.</p>
<p>This part of the course contains some really hard material. This is deliberate because the workings of most computer codes are actually based on some astonishingly intricate mathematics. This is really intended to provide a decent reference for people coming back to use finite elements or other numerical methods later.</p>
</div>
<div class="section" id="numerical-modeling-primer">
<h2>Numerical modeling primer<a class="headerlink" href="#numerical-modeling-primer" title="Permalink to this headline">¶</a></h2>
<p>We start with the numerical solution of a very simple differential equation. In fact we choose something simple enough that we already know the answer.</p>
<div class="math notranslate nohighlight">
\[
    \frac{d\theta}{dt} = - k \theta
    \label{eq:ode_decay}
\]</div>
<p>This is the equation which governs radioactive decay, in which case <span class="math notranslate nohighlight">\(\theta\)</span> is the amount of the radioactive isotope remaining and <span class="math notranslate nohighlight">\(d\theta /  dt\)</span> is the activity that we can measure. <span class="math notranslate nohighlight">\(k\)</span> is closely related to the half life.</p>
<p>The solution to this equation is</p>
<div class="math notranslate nohighlight">
\[ 
    \theta(t) = \theta_0 e^{-kt}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta_0\)</span> is the amount of the radioactive material remaining. The same equation also describes the cooling of, say, a cup of coffee. In this case we interpret <span class="math notranslate nohighlight">\(\theta\)</span> as the excess temperature (above room temperature).</p>
<p><img alt="Marching through time in small increments" src="../_images/theta_t.png" /></p>
<p>We want to march forward in time from our starting point where <span class="math notranslate nohighlight">\(\theta = \theta_0\)</span> to obtain the value of <span class="math notranslate nohighlight">\(\theta\)</span> at later times. To do this, we need to approximate the original differential equation, and, in particular, the value of the time derivative at each time. There are a number of ways to do this.</p>
<div class="section" id="a-first-order-numerical-approximation">
<h3>A first order numerical approximation}<a class="headerlink" href="#a-first-order-numerical-approximation" title="Permalink to this headline">¶</a></h3>
<p>Assume that the variation in <span class="math notranslate nohighlight">\(\theta(t)\)</span> is linear, i.e.</p>
<div class="math notranslate nohighlight">
\[ 
    \theta(t') = \theta_n + \beta t'
\]</div>
<p>where we use a local time coordinate <span class="math notranslate nohighlight">\(t' = t - n\Delta t\)</span>, so that when we differentiate</p>
<div class="math notranslate nohighlight">
\[ 
    \frac{d \theta}{dt} = \beta
\]</div>
<p>To determine the approximation for the derivative therefore becomes the solution to the following equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    \begin{split}
        &amp; \theta_{n+1} = \theta_n + \beta \Delta t \\
        &amp; \Rightarrow   \beta = \frac{d \theta}{dt} = \frac{\theta_{n+1} - \theta_n}{\Delta t}
    \end{split}
\end{split}\]</div>
<p>This is a first order difference expression for the derivative which we substitute into the original differential equation (\ref{eq:ode_decay}) at the current timestep</p>
<div class="math notranslate nohighlight">
\[    \frac{\theta_{n+1} - \theta_n}{\Delta t} = - k \theta_n
 
\]</div>
<p>This rearranges to give us a time-marching algorithm:</p>
<div class="math notranslate nohighlight">
\[ 
    \theta_{n+1} = \theta_n (1-k \Delta t)
\]</div>
<p>It is an indication of the fact that this problem is really not all that difficult that this difference equation can be written recursively to give:</p>
<div class="math notranslate nohighlight">
\[ 
    \theta_{n+1} = \theta_0 (1-k \Delta t)^n
\]</div>
<p>In a moment we will compute some values for this expression to see how accurate it is. First we consider whether we can improve the accuracy of the approximation by doing a bit more work.</p>
</div>
<div class="section" id="higher-order-expansion">
<h3>Higher order expansion<a class="headerlink" href="#higher-order-expansion" title="Permalink to this headline">¶</a></h3>
<p>First we try fitting the local expansion for <span class="math notranslate nohighlight">\(\theta\)</span> through an additional point.   This time we assume that the variation in <span class="math notranslate nohighlight">\(\theta(t)\)</span> is quadratic, i.e.</p>
<div class="math notranslate nohighlight">
\[    \theta(t') = \theta_{n-1} + \beta t' + \gamma {t'}^2
 
\]</div>
<p>The local time coordinate is <span class="math notranslate nohighlight">\(t' = t - (n-1)\Delta t\)</span>, and when we differentiate</p>
<div class="math notranslate nohighlight">
\[    \frac{d \theta}{dt} = \beta + 2 \gamma t'
    \label{eq:dthdt2}
 
\]</div>
<p>To solve for <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span> we fit the curve through
the sample points:</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
    \begin{split}
    \theta_n &amp;= \theta_{n-1} + \beta \Delta t + \gamma (\Delta t)^2 \\
    \theta_{n+1} &amp;= \theta_{n-1} + 2 \beta \Delta t + 4 \gamma (\Delta t)^2
    \end{split}
 
\end{split}\]</div>
<p>Which we can solve to give this:</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
 
    \begin{split}
            \beta &amp;= \left( 4 \theta_n - \theta_{n+1} - 3\theta_{n-1} \right) \frac{1}{2\Delta t} \\
            \gamma &amp;= \left( \theta_{n+1} + \theta_{n-1} -2 \theta_n \right) \frac{1}{2\Delta t^2} 
    \end{split}
 
\end{split}\]</div>
<p>By substituting into \( (\ref{eq:dthdt2}) \), and then into the original differential equation \( (\ref{eq:ode_decay}) \) we obtain the following</p>
<div class="math notranslate nohighlight">
\[        
            \left. \frac{d\theta}{dt} \right|_{t=n\Delta t} = \beta + 2\gamma \Delta t =
                \frac{1}{2\Delta t} \left( \theta_{n+1} - \theta_{n-1} \right)  = -k \theta_n 
 
\]</div>
<p>The difference approximation to the derivative turns out to be the average of the expressions for the previous derivative and the new derivative. We have now included information about the current timestep and the previous timestep in our expression for the value of <span class="math notranslate nohighlight">\(\theta\)</span> at the forthcoming timestep:
$$</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     \theta_{n+1} = \theta_{n-1} -2k \theta_n \Delta t
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}### A comparison of the two schemes\\How well do these two methods perform, and what difference does the choice of $\Delta t$ make on the accuracy ?\\
|   t   | $^1\theta_H$ | $^1\theta_h$ | $^2\theta_H$  | $^2\theta_h$   | Exact    |
| ----- |--------------| ------------ | --------------| -------------- | ---------|
|   0.0 |   1.0000     | 1.0000       | 1.0000        | 1.0000         | 1.0000   |
|   0.1 |   ---        | 0.9000       | ---           | 0.9000         | 0.9048   |
|   0.2 |   0.8000     | 0.8100       | 0.8000        | 0.8200         | 0.8187   |
|   0.3 |   ---        | 0.7290       | ---           | 0.7360         | 0.7408   |
|   0.4 |   0.6400     | 0.6561       | 0.6800        | 0.6728         | 0.6703   |
|   0.5 |   ---        | 0.5905       | ---           | 0.6014         | 0.6063   |
|   0.6 |   0.5120     | 0.5314       | 0.5280        | 0.5525         | 0.5488   |
|   0.7 |   ---        | 0.4783       | ---           | 0.4909         | 0.4966   |
|   0.8 |   0.4096     | 0.4305       | 0.4688        | 0.4543         | 0.4483   |
|   0.9 |   ---        | 0.3874       | ---           | 0.4001         | 0.4066   |
|   1.0 |   0.3277     | 0.3487       | 0.3405        | 0.3743         | 0.3679   |
[Results of the numerical simulation of the decay equation. $^1\theta_H$ is from the first order expansion of $\theta(t)$, at a timestep of $\Delta t=0.2$, and $^2\theta_H$ is the second order expansion at $\Delta t=0.2$; other calculations are at $\Delta t = 0.1$. $^1\theta_h$ is the linear expansion,  $^2\theta_h$ results from the quadratic expansion of $\theta(t)$. The actual solution is also shown.][table-two-schemes]\\The results are more accurate when a smaller timestep is used although it requires more computation to achieve the greater accuracy. Higher order expansion also increases the accuracy and may be more efficient in terms of the number of computations required for a given level of accuracy. Note, however, that the supposedly better quadratic expansion produces an error which oscillates as time increases. Does this error grow ? Does this make second order expansions useless ?\\
### Second Order Runge-Kutta\\![ different way to derive a second order method][rk2]\\[rk2]: ./Diagrams/theta_rk2-.png\\
The Runge-Kutta approach to higher order integration methods is [illustrated in the figure](#rk2). The idea is to estimate the gradient $d \theta / d t$ at the half way point between two timestep values.  This is done in two stages. Initially a first order estimate, $\hat{\theta}$ is made for the value of the function $\theta$ at $t=t+\Delta t /2$ in the future. This value is then subsituted into the differential equation to obtain the estimate for the gradient at this time. The revised gradient is then used to update the original $\theta(t)$ by an entire timestep.\\The first order step is
\end{aligned}\end{align} \]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>\begin{split}
    \hat{\theta}(t+\Delta t /2) &amp; = \theta(t) + \left.  \frac{d \theta}{d t} \right|_t \frac{\Delta t}{2} \\
        &amp;= \theta(t) \left[ 1-\frac{k\Delta t}{2} \right]
\end{split}
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[
Substitute to estimate the gradient at the mid-point
\]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> \left. \frac{d \theta}{d t} \right|_{t+\Delta t /2} \approx -k \theta(t)  \left[ 1-\frac{k\Delta t}{2} \right]
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[
Use this value as the average gradient over the interval $t\rightarrow t+\Delta t$ to
update $\theta$
\]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>\begin{split}
    \theta(t+\Delta t) &amp; \approx \theta(t) + \delta t \left(  -k \theta(t)  \left[ 1-\frac{k\Delta t}{2} \right]  \right) \\
        &amp; \approx \theta(t) \left( 1 - k \Delta t + k^2 \frac{\Delta t^2}{2} \right)
\end{split}
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[
It's worth noting that the Taylor expansion of the solution should look like
\]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e^{-kt} = 1 - kt + \frac{k^2 t^2}{2!} - \frac{k^3 t^3}{3!} + \ldots
</pre></div>
</div>
<p>$$</p>
<p>The Runge Kutta method can be extended by repeating the estimates on smaller regions of the interval. The usual choice is fourth order RK. This is largely because, obviously, it’s accurate to fourth order, but also because the number of operations to go higher than fourth order is disproportionately large. See Numerical Recipes for a discussion on this and better methods for ODE’s.</p>
</div>
<div class="section" id="our-first-code">
<h3>Our First Code<a class="headerlink" href="#our-first-code" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to answer our earlier question is to code the methods and see. The following is a script which computes the first and second order expressions and the Runge-Kutta method, and compares with the “exact” solution (which is numerical as well, of course, but computed through series expansions and the like).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare various ways to integrate the </span>
<span class="c1"># ODE for radioactive decay / Newton&#39;s law of cooling.</span>
<span class="c1"># Assume decay constant of 1.0</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="n">timestep</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>

<span class="c1"># Initial value ... </span>

<span class="n">theta1_0</span>   <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">theta2_0</span>   <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">thetaRK2_0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># First timestep (by hand, then automate for subsequent cases)</span>

<span class="n">theta1_1</span>   <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">theta2_1</span>   <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">thetaRK_1</span>  <span class="o">=</span> <span class="mf">0.905</span>

<span class="c1"># Now we have enough information to automate all the methods </span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1001</span><span class="p">):</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">i</span>
    <span class="n">exact</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">time</span><span class="p">)</span>

    <span class="n">theta1_2</span>  <span class="o">=</span> <span class="n">theta1_1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">timestep</span><span class="p">)</span>
    <span class="n">theta2_2</span>  <span class="o">=</span> <span class="n">theta2_0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span>  <span class="n">theta2_1</span> <span class="o">*</span> <span class="n">timestep</span>
    <span class="n">thetaRK_2</span> <span class="o">=</span> <span class="n">thetaRK_1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">timestep</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">timestep</span><span class="p">)</span>

  <span class="c1"># output data every 25th step</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">25</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;Timestep </span><span class="si">{:04d}</span><span class="s2"> </span><span class="si">{:.4f}</span><span class="se">\t</span><span class="s2"> </span><span class="si">{:.4e}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{:.4e}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{:.4e}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{:.4e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">theta1_2</span><span class="p">,</span><span class="n">theta2_2</span><span class="p">,</span><span class="n">thetaRK_2</span><span class="p">,</span><span class="n">exact</span><span class="p">)</span>
                
  <span class="c1"># keep old values (not all are needed, of course)</span>

    <span class="n">theta1_0</span>  <span class="o">=</span> <span class="n">theta1_1</span>
    <span class="n">theta2_0</span>  <span class="o">=</span> <span class="n">theta2_1</span>
    <span class="n">thetaRK_0</span> <span class="o">=</span> <span class="n">thetaRK_1</span>

    <span class="n">theta1_1</span>  <span class="o">=</span> <span class="n">theta1_2</span>
    <span class="n">theta2_1</span>  <span class="o">=</span> <span class="n">theta2_2</span>
    <span class="n">thetaRK_1</span> <span class="o">=</span> <span class="n">thetaRK_2</span>

<span class="sd">&quot;&quot;&quot; Output:</span>
<span class="sd">Timestep 0025 2.5000     +7.1790e-02     +5.2117e-02     +8.2455e-02     +8.2085e-02</span>
<span class="sd">Timestep 0050 5.0000     +5.1538e-03     +3.7201e-01     +6.7987e-03     +6.7379e-03</span>
<span class="sd">Timestep 0075 7.5000     +3.6999e-04     -4.4304e+00     +5.6059e-04     +5.5308e-04</span>
<span class="sd">Timestep 0100 10.0000    +2.6561e-05     +5.3757e+01     +4.6223e-05     +4.5400e-05</span>
<span class="sd">Timestep 0125 12.5000    +1.9068e-06     -6.5219e+02     +3.8113e-06     +3.7267e-06</span>
<span class="sd">Timestep 0150 15.0000    +1.3689e-07     +7.9124e+03     +3.1426e-07     +3.0590e-07</span>
<span class="sd">Timestep 0175 17.5000    +9.8274e-09     -9.5993e+04     +2.5912e-08     +2.5110e-08</span>
<span class="sd">Timestep 0200 20.0000    +7.0551e-10     +1.1646e+06     +2.1366e-09     +2.0612e-09</span>
<span class="sd">Timestep 0225 22.5000    +5.0648e-11     -1.4129e+07     +1.7617e-10     +1.6919e-10</span>
<span class="sd">Timestep 0250 25.0000    +3.6360e-12     +1.7141e+08     +1.4526e-11     +1.3888e-11</span>
<span class="sd">Timestep 0275 27.5000    +2.6103e-13     -2.0796e+09     +1.1977e-12     +1.1400e-12</span>
<span class="sd">Timestep 0300 30.0000    +1.8739e-14     +2.5230e+10     +9.8758e-14     +9.3576e-14</span>
<span class="sd">Timestep 0325 32.5000    +1.3453e-15     -3.0609e+11     +8.1431e-15     +7.6812e-15</span>
<span class="sd">Timestep 0350 35.0000    +9.6578e-17     +3.7135e+12     +6.7143e-16     +6.3051e-16</span>
<span class="sd">Timestep 0375 37.5000    +6.9333e-18     -4.5052e+13     +5.5363e-17     +5.1756e-17</span>
<span class="sd">Timestep 0400 40.0000    +4.9774e-19     +5.4658e+14     +4.5649e-18     +4.2484e-18</span>
<span class="sd">Timestep 0425 42.5000    +3.5733e-20     -6.6311e+15     +3.7640e-19     +3.4873e-19</span>
<span class="sd">Timestep 0450 45.0000    +2.5652e-21     +8.0449e+16     +3.1036e-20     +2.8625e-20</span>
<span class="sd">Timestep 0475 47.5000    +1.8416e-22     -9.7602e+17     +2.5590e-21     +2.3497e-21</span>
<span class="sd">Timestep 0500 50.0000    +1.3221e-23     +1.1841e+19     +2.1100e-22     +1.9287e-22</span>
<span class="sd">Timestep 0525 52.5000    +9.4911e-25     -1.4366e+20     +1.7398e-23     +1.5832e-23</span>
<span class="sd">Timestep 0550 55.0000    +6.8137e-26     +1.7429e+21     +1.4346e-24     +1.2996e-24</span>
<span class="sd">Timestep 0575 57.5000    +4.8915e-27     -2.1144e+22     +1.1829e-25     +1.0668e-25</span>
<span class="sd">Timestep 0600 60.0000    +3.5116e-28     +2.5653e+23     +9.7532e-27     +8.7565e-27</span>
<span class="sd">Timestep 0625 62.5000    +2.5210e-29     -3.1122e+24     +8.0420e-28     +7.1878e-28</span>
<span class="sd">Timestep 0650 65.0000    +1.8098e-30     +3.7757e+25     +6.6310e-29     +5.9001e-29</span>
<span class="sd">Timestep 0675 67.5000    +1.2993e-31     -4.5807e+26     +5.4675e-30     +4.8431e-30</span>
<span class="sd">Timestep 0700 70.0000    +9.3273e-33     +5.5574e+27     +4.5082e-31     +3.9754e-31</span>
<span class="sd">Timestep 0725 72.5000    +6.6961e-34     -6.7423e+28     +3.7172e-32     +3.2632e-32</span>
<span class="sd">Timestep 0750 75.0000    +4.8071e-35     +8.1797e+29     +3.0650e-33     +2.6786e-33</span>
<span class="sd">Timestep 0775 77.5000    +3.4510e-36     -9.9237e+30     +2.5273e-34     +2.1988e-34</span>
<span class="sd">Timestep 0800 80.0000    +2.4775e-37     +1.2040e+32     +2.0838e-35     +1.8049e-35</span>
<span class="sd">Timestep 0825 82.5000    +1.7786e-38     -1.4606e+33     +1.7182e-36     +1.4815e-36</span>
<span class="sd">Timestep 0850 85.0000    +1.2768e-39     +1.7721e+34     +1.4167e-37     +1.2161e-37</span>
<span class="sd">Timestep 0875 87.5000    +9.1663e-41     -2.1499e+35     +1.1682e-38     +9.9824e-39</span>
<span class="sd">Timestep 0900 90.0000    +6.5805e-42     +2.6082e+36     +9.6321e-40     +8.1940e-40</span>
<span class="sd">Timestep 0925 92.5000    +4.7241e-43     -3.1643e+37     +7.9421e-41     +6.7261e-41</span>
<span class="sd">Timestep 0950 95.0000    +3.3914e-44     +3.8390e+38     +6.5486e-42     +5.5211e-42</span>
<span class="sd">Timestep 0975 97.5000    +2.4347e-45     -4.6575e+39     +5.3996e-43     +4.5320e-43</span>
<span class="sd">Timestep 1000 100.0000   +1.7479e-46     +5.6505e+40     +4.4522e-44     +3.7201e-44</span>
<span class="sd">&quot;&quot;&quot;</span>
 
</pre></div>
</div>
<p>Clearly, the quadratic expansion does not do a good job in this particular case, since the error is a growing instability which makes the solution useless almost immediately. However, the second order Runge-Kutta method is very accurate. This gives a clear warning that numerical solution of equations is partly an art (though the stability or otherwise of a given method can actually be proven formally in many cases).</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Part3-NumericalMethods"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../Part1-FluidDynamics/LithosphericDynamics.html" title="previous page">Dynamics of the Lithosphere</a>
    <a class='right-next' id="next-link" href="NumericalMethods2.html" title="next page">Survey of numerical methods</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Louis Moresi<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>