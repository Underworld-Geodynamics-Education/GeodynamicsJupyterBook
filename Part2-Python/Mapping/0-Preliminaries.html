

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Datasets &#8212; Geodynamics with Underworld</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cartopy" href="1-IntroductingCartopy.html" />
    <link rel="prev" title="Maps with the Cartopy Package" href="00-Maps_with_Cartopy.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/MundusSubterraneus.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Geodynamics with Underworld</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../FrontPage.html">
   Geodynamics with Underworld
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction and Background
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part0-Introduction/Introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematical Fluid Dynamics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part1-FluidDynamics/ContinuumMechanics.html">
   Conservation Laws
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part1-FluidDynamics/NavierStokes.html">
   Navier-Stokes Equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part1-FluidDynamics/MantleDynamics.html">
   Non-dimensional equations &amp; dimensionless numbers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part1-FluidDynamics/ThermalConvection.html">
   Thermal Convection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part1-FluidDynamics/LithosphericDynamics.html">
   Dynamics of the Lithosphere
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Numerical Modeling
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part3-NumericalMethods/NumericalMethods1.html">
   Numerical Modeling in Solid Earth Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part3-NumericalMethods/NumericalMethods2.html">
   Survey of numerical methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part3-NumericalMethods/NumericalMethods3.html">
   Introduction to the Finite Element Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part3-NumericalMethods/NumericalMethods4.html">
   Practical Finite Elements
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Part3-NumericalMethods/NumericalMethods5.html">
   Methods for Solving Numerical Problems
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python for Geoscientists
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../0-StartHere.html">
   Python for Earth Scientists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NumpyAndScipy/0-NumpyAndScipy.html">
   Numpy and Scipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Plotting/1-IntroductionToMatplotlib.html">
   Introduction to matplotlib
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="00-Maps_with_Cartopy.html">
   Maps with the Cartopy Package
  </a>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="1-IntroductingCartopy.html">
     Cartopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2-ImagesAndGeoTIFFs.html">
     Handling images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3-WorkingWithRealData.html">
     Australian magnetic intensity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4-ContouringGlobalData.html">
     How to use contours to view global data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5-WorkingWithPointData.html">
     Point Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="6-WorkingWithShuttleRadarTopography.html">
     Cartopy and the Shuttle Radar Topography Map data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="7-WorkingWithOn-DemandMappingServices.html">
     On demand mapping services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="8-GlobalPlateMotionsEtc.html">
     Global Plate Motions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9-HimalayaRegionMapsAndImages.html">
     Himalaya Maps (1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9a-HimalayaRegionMapsAndImages-Pt2.html">
     Himalaya Maps (2)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../SphericalMeshing/0-Stripy.html">
   Triangulations
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../_sources/Part2-Python/Mapping/0-Preliminaries.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/Part2-Python/Mapping/0-Preliminaries.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Underworld-Geodynamics-Education/GeodynamicsJupyterBook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/Underworld-Geodynamics-Education/GeodynamicsJupyterBook/master?urlpath=tree/Part2-Python/Mapping/0-Preliminaries.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://demon.underworldcloud.org/hub/user-redirect/git-pull?repo=https://github.com/Underworld-Geodynamics-Education/GeodynamicsJupyterBook&urlpath=tree/GeodynamicsJupyterBook/Part2-Python/Mapping/0-Preliminaries.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-magnetic-data">
   Global Magnetic Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#topography-data">
   Topography data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nasa-blue-marble-images">
   NASA Blue marble images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#earthquake-hypocentres">
   Earthquake hypocentres
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-age-grid">
   Global age grid
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#global-strain-rate">
   Global strain rate
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-datasets-that-we-use-for-this-course-are-kept-in-a-central-location">
   The datasets that we use for this course are kept in a central location.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-resources-database">
   The resources “database”
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="datasets">
<h1>Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h1>
<p>We need to download some data for the examples. Some files are bundled with the notebooks because I am not smart enough to understand how to download them through the various web / ftp interfaces directly or I needed to filter or compress the information for the purposes of the class. Please go to the original sites if you need to use these data for anything other than the demonstrations in these notebooks.</p>
<p>Most datasets are too large for the repository (and generally, that’s not a place to keep anything which is not the primary target of revision management. The bundled data are compressed and will be unpacked (copied) to the <code class="docutils literal notranslate"><span class="pre">../../Data/Resources</span></code> directory by the “download” functions in this notebook. If you mess them up, just run the download again. Anything that is undamaged will just be be skipped anyway.</p>
<div class="section" id="global-magnetic-data">
<h2>Global Magnetic Data<a class="headerlink" href="#global-magnetic-data" title="Permalink to this headline">¶</a></h2>
<p>Magnetic intensity data from <a class="reference external" href="http://geomag.org/models/EMAG2/EMAG2_V2.tif">geomag.org</a></p>
</div>
<div class="section" id="topography-data">
<h2>Topography data<a class="headerlink" href="#topography-data" title="Permalink to this headline">¶</a></h2>
<p>ETOPO1 images are from NOAA - we use their geotifs which are subsampled from the original (enormous) dataset but</p>
</div>
<div class="section" id="nasa-blue-marble-images">
<h2>NASA Blue marble images<a class="headerlink" href="#nasa-blue-marble-images" title="Permalink to this headline">¶</a></h2>
<p>Winter and Summer images for the Earth are grabbed for plotting examples. The winter ones (June) are used by default as these have less ice in the N. Hemisphere.</p>
</div>
<div class="section" id="earthquake-hypocentres">
<h2>Earthquake hypocentres<a class="headerlink" href="#earthquake-hypocentres" title="Permalink to this headline">¶</a></h2>
<p>Are grabbed from the <a class="reference external" href="http://earthquake.usgs.gov/earthquakes/search/">NEIC</a> - they are in the geoJSON format since that is very simple to read with python. The downloads are limited at 20k events so the time and magnitude range is whatever it takes to get just under this limit. The filenames give clues about that, but, so does the catalogue itself once it is read in.</p>
</div>
<div class="section" id="global-age-grid">
<h2>Global age grid<a class="headerlink" href="#global-age-grid" title="Permalink to this headline">¶</a></h2>
<p>Taken from Earthbyte and reduced in size by throwing away the grid information and saving in compressed numpy format.</p>
</div>
<div class="section" id="global-strain-rate">
<h2>Global strain rate<a class="headerlink" href="#global-strain-rate" title="Permalink to this headline">¶</a></h2>
<p>I grabbed the second invariant of the strain rate from the <a class="reference external" href="http://gsrm.unavco.org/intro">global strain rate map</a> project through the ‘Jules Vernes’ portal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sh</span>

<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">../../</span><span class="n">Data</span><span class="o">/</span><span class="n">Reference</span><span class="o">/</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">../../</span><span class="n">Data</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span>

<span class="n">cp</span> <span class="o">../../</span><span class="n">Data</span><span class="o">/</span><span class="n">Reference</span><span class="o">/*</span> <span class="o">../../</span><span class="n">Data</span><span class="o">/</span><span class="n">Resources</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-datasets-that-we-use-for-this-course-are-kept-in-a-central-location">
<h2>The datasets that we use for this course are kept in a central location.<a class="headerlink" href="#the-datasets-that-we-use-for-this-course-are-kept-in-a-central-location" title="Permalink to this headline">¶</a></h2>
<p>These can be downloaded on demand but the smaller files are stored away in the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> directory and copied to the <code class="docutils literal notranslate"><span class="pre">Resources</span></code> directory.</p>
<ul class="simple">
<li><p>Why do I do that ?</p></li>
</ul>
<p>So if you happen to delete or break one of the datasets, we can get a new copy. <strong>Expand the cell</strong> to see the details of the download and caching mechanism.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">md5</span></code> checksums</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">requests</span></code> module for handling urls (properly)</p></li>
<li><p>exception handling (!)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">url</span><span class="p">)):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">)</span>
        
<span class="c1"># and so on ...         </span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Here are some functions to download or install files. </span>


<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">):</span>
    
    
<span class="c1"># We might want to bundle some files if they are small / compressed or not readily available for download</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">url</span><span class="p">)):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">local_filename</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">last_time</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="n">datasize</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">10000000</span><span class="p">):</span> 
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span> <span class="c1"># filter out keep-alive new chunks</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">datasize</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">:</span>
                        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2"> Mb in </span><span class="si">{:.1f}</span><span class="s2">s / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datasize</span> <span class="o">/</span> <span class="mf">1.0e6</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">))</span>
                        <span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">return</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">md5sum</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">buf</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>




<span class="k">def</span> <span class="nf">download_cached_file</span><span class="p">(</span><span class="n">location_url</span><span class="p">,</span> <span class="n">local_file</span><span class="p">,</span> <span class="n">expected_md5</span><span class="p">,</span> <span class="n">expected_size</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">md5sum</span><span class="p">(</span><span class="n">local_file</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_md5</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Using cached file - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">local_file</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error_info</span><span class="p">:</span>
        <span class="c1"># No file or the wrong file ... best go download it</span>
        <span class="c1"># print &quot;Assertion failed - {}&quot;.format(sys.exc_info())</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_file</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">location_url</span><span class="p">,</span> <span class="n">local_file</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Downloaded from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">location_url</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Unable to download </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">] &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">location_url</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span> <span class="p">))</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">report_cached_file</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span> <span class="n">expected_md5</span><span class="p">):</span>
    
    <span class="kn">import</span> <span class="nn">os.path</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_file</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Local file </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">local_file</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_md5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">md5sum</span><span class="p">(</span><span class="n">local_file</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_md5</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Cached file </span><span class="si">{}</span><span class="s2"> is valid&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">local_file</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Cached file </span><span class="si">{}</span><span class="s2"> failed, checksum </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span> <span class="n">md5sum</span><span class="p">(</span><span class="n">local_file</span><span class="p">)))</span>
        
        
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-resources-database">
<h2>The resources “database”<a class="headerlink" href="#the-resources-database" title="Permalink to this headline">¶</a></h2>
<p>The files are managed by keeping a table of the download point and a checksum to validate the file.</p>
<p>Although it is a little laborious to set this up, it is a useful way to keep track of the data sources. For very large collections, you would probably do better with a database not a hand-built dictionary</p>
<p>The database takes the form of a dictionary like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">resource_list</span> <span class="o">=</span> <span class="p">[</span>
<span class="c1"># Global magnetic data </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/EMAG2_image_V2.tif&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s2">&quot;c4944c27ed22ddc89225e506936b016b&quot;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://geomag.org/models/EMAG2/EMAG2_image_V2.tif&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;133Mb&quot;</span>
<span class="p">},</span>

<span class="c1"># and so on ... </span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ../../Data/Resources required for the tutorial</span>
<span class="c1"># The checksum is to make sure any cached file is the right one.</span>
<span class="c1"># If the checksum is wrong the file gets downloaded again.</span>

<span class="c1"># Some of these files are local, stored in the repo in compressed form and installed into the</span>
<span class="c1"># ../../Data/Resources directory. </span>

<span class="n">resource_list</span> <span class="o">=</span> <span class="p">[</span>
<span class="c1"># Global magnetic data </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/EMAG2_image_V2.tif&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s2">&quot;c4944c27ed22ddc89225e506936b016b&quot;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://geomag.org/models/EMAG2/EMAG2_image_V2.tif&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;133Mb&quot;</span>
<span class="p">},</span>
    
<span class="c1"># Australian Mag Data from AuScope portal (built by hand)</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/AusMagAll.tiff.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/AusMagAll.tiff.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;10Mb&quot;</span>
<span class="p">},</span>
    
<span class="c1"># Blue Marble Image Geotiff June 2004 (11Mb)  </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span> <span class="s2">&quot;../../Data/Resources/BlueMarbleNG-TB_2004-06-01_rgb_3600x1800.TIFF&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span> <span class="s1">&#39;55e1399674d43a26353d84c114d7ff80&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://neo.sci.gsfc.nasa.gov/servlet/RenderData?si=526294&amp;cs=rgb&amp;format=TIFF&amp;width=3600&amp;height=1800&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;11Mb&quot;</span>
<span class="p">},</span>
    
    
<span class="c1"># Blue Marble Image with Bathymetry png - December 2004 </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span> <span class="s2">&quot;../../Data/Resources/BlueMarbleNG-TB_2004-12-01_rgb_3600x1800.TIFF&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span> <span class="s1">&#39;825da4b417ae19e24d2ea6db6cf8ad21&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://neo.sci.gsfc.nasa.gov/servlet/RenderData?si=526311&amp;cs=rgb&amp;format=TIFF&amp;width=3600&amp;height=1800&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;11Mb&quot;</span>
<span class="p">},</span>
    
<span class="c1"># Etopo1 - color image </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span> <span class="s2">&quot;../../Data/Resources/color_etopo1_ice_low.tif.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span> <span class="s1">&#39;3f53d72e85393deb28874db0c76fbfcb&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/color_etopo1_ice_low.tif.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;35Mb&quot;</span>
<span class="p">},</span>
    
<span class="c1"># Etopo1 - bw shaded relief image </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span> <span class="s2">&quot;../../Data/Resources/etopo1_grayscale_hillshade.tif.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span> <span class="s1">&#39;f38b8dc6cd971d72e77edaa837d5b85c&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/image/etopo1_grayscale_hillshade.tif.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;115Mb&quot;</span>
<span class="p">},</span>
    
    
<span class="c1"># ETOPO_c_geotiff_10800 ... cell centred data for ETOPO1 </span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span> <span class="s2">&quot;../../Data/Resources/ETOPO_c_geotiff_10800.tif.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s2">&quot;fbd0478d0974ca433cdd5cb3530d0d48&quot;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/data/ice_surface/cell_registered/georeferenced_tiff/ETOPO1_Ice_c_geotiff.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;320Mb&quot;</span>
<span class="p">},</span>    
    
<span class="c1"># Natural Earth Hypsometry Images (same grid size as ETOPO1 image above)</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/HYP_50M_SR_W.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s2">&quot;f3323bc6f38ddec98cff4936fb324ec5&quot;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/raster/HYP_50M_SR_W.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;102Mb&quot;</span>
<span class="p">},</span>   
 
<span class="c1"># Natural Earth Ocean Bottom Images (same grid size as ETOPO1 image above)</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/OB_50M.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s2">&quot;69a2ed6ff8cf30b2dedd2d80461f9e43&quot;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/raster/OB_50M.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;50Mb&quot;</span>
<span class="p">},</span>   
            
<span class="c1"># Global age grid  [LOCAL]</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/global_age_data.3.6.z.npz&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/global_age_data.3.6.z.npz&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;22Mb&quot;</span>
<span class="p">},</span>
 
<span class="c1"># Global age grid (raw) [LOCAL]</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/global_age_data.3.6.xyz.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/global_age_data.3.6.xyz&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;22Mb&quot;</span>
<span class="p">},</span>


<span class="c1"># Global second invariant of strain rate [LOCAL]</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/sec_invariant_strain_0.2.dat.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/sec_invariant_strain_0.2.dat.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;4Mb&quot;</span>
<span class="p">},</span>
  
    
<span class="c1"># Earthquake data for various regions as json files [LOCAL]</span>
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/Earthquake_data.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/Earthquake_data.zip&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;4Mb&quot;</span>
<span class="p">},</span>
    
    
<span class="c1"># Global surface velocity vector fields in various reference frames:</span>
<span class="c1"># http://gsrm.unavco.org/model/</span>
<span class="c1"># There are others ... </span>
    
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_AU.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_AU.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   
  
<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_EU.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_EU.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_IN.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_IN.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_NA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_NA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_OK.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_OK.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_NNR.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_NNR.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_PA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_PA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   


<span class="p">{</span>
 <span class="s2">&quot;local_file&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Resources/velocity_TA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;md5&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="s2">&quot;../../Data/Reference/velocity_TA.nc&quot;</span><span class="p">,</span>
 <span class="s2">&quot;expected_size&quot;</span><span class="p">:</span><span class="s2">&quot;1Mb&quot;</span>
<span class="p">},</span>   

       
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resource_list</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Checking </span><span class="si">{:s}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;local_file&quot;</span><span class="p">],</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">]))</span>
    <span class="n">report_cached_file</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;local_file&quot;</span><span class="p">],</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># md5sum(&quot;../../Data/Resources/EMAG2_image_V2.tif&quot;)</span>
  

<span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Readme.md&quot;</span>

<span class="kn">import</span> <span class="nn">hashlib</span> 
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">md5sum</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">buf</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">md5sum</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resource_list</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Downloading </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;local_file&quot;</span><span class="p">]))</span>
    <span class="n">download_cached_file</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;local_file&quot;</span><span class="p">],</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">],</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;expected_size&quot;</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract any files that were downloaded as zip archives (keep the originals to avoid re-downloading)</span>

<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="k">for</span> <span class="n">zipped</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;../../Data/Resources/*.zip&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zipped</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s2">&quot;../../Data/Resources&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Unzipped </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># if you add a new url / file to the download list above, add the md5 checksum as well !</span>
<span class="c1"># unless it is small enough to have a local copy. I would suggest still providing a url</span>
<span class="c1"># in the comments just in case.</span>

<span class="n">md5sum</span><span class="p">(</span><span class="s2">&quot;../../Data/Resources/etopo1_grayscale_hillshade.tif.zip&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Part2-Python/Mapping"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="00-Maps_with_Cartopy.html" title="previous page">Maps with the Cartopy Package</a>
    <a class='right-next' id="next-link" href="1-IntroductingCartopy.html" title="next page">Cartopy</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Louis Moresi<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>